{% extends "base.html" %}
{% block content %}
<div class="max-w-5xl mx-auto py-8 px-4">
  <div class="flex items-baseline justify-between gap-4 mb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">{{ page_title }}</h1>
      <p class="text-gray-600 mt-1">Find a team to join—or jump into ones you already belong to.</p>
    </div>
    <a href="{% url 'teams:team_create' %}"
       class="inline-flex items-center px-4 py-2 rounded-lg bg-indigo-600 text-white font-medium shadow hover:bg-indigo-700">
      + Create Team
    </a>
  </div>

  <!-- Filters / Search -->
  <form method="get" class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm mb-6">
    <div class="flex flex-wrap items-end gap-3">
      <div class="flex-1 min-w-[240px]">
        <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
        <input type="text" name="q" value="{{ q|default:'' }}"
               placeholder="Search by name or description"
               class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Filter</label>
        <select name="filter"
                class="rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
          <option value="all" {% if filter == "all" %}selected{% endif %}>All teams</option>
          <option value="mine" {% if filter == "mine" %}selected{% endif %}>My teams</option>
          <option value="joinable" {% if filter == "joinable" %}selected{% endif %}>Joinable</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Per page</label>
        <select name="per_page"
            class="rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
            {% for n in per_page_options %}
                <option value="{{ n }}" {% if per_page|stringformat:"s" == n|stringformat:"s" %}selected{% endif %}>
                {{ n }}
                </option>
            {% endfor %}
        </select>

      </div>

      <div class="ml-auto">
        <button type="submit"
                class="inline-flex items-center px-4 py-2 rounded-lg bg-gray-800 text-white font-medium shadow hover:bg-gray-900">
          Apply
        </button>
      </div>
    </div>
  </form>

  <!-- List -->
  {% if page_obj.object_list %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
      {% for team in page_obj.object_list %}
        <div class="bg-white border border-gray-200 rounded-xl p-5 shadow-sm hover:shadow-md transition">
          <div class="flex items-start justify-between gap-3">
            <h3 class="text-lg font-semibold text-gray-900">{{ team.team_name }}</h3>
            {% if team.is_member %}
              <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full bg-green-100 text-green-800">
                Member
              </span>
            {% endif %}
          </div>

          <p class="text-sm text-gray-600 mt-2">
            {{ team.team_desc|default:"No description provided." }}
          </p>

          <div class="flex items-center gap-4 mt-3 text-sm text-gray-500">
            <span class="inline-flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4S14.21 4 12 4 8 5.79 8 8s1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
              {{ team.member_count }} member{% if team.member_count != 1 %}s{% endif %}
            </span>
            <span>•</span>
            <span>Created {{ team.created_at|date:"M j, Y" }}</span>
          </div>

          <div class="mt-4 flex gap-2">
            {% if team.is_member %}
              <a href="{% url 'teams:team_dashboard' team_id=team.id %}"
                 class="inline-flex items-center justify-center px-3 py-2 rounded-lg bg-indigo-600 text-white font-medium hover:bg-indigo-700">
                View Dashboard
              </a>
            {% else %}
              <a href="{% url 'teams:team_join' team_id=team.id %}"
                 class="inline-flex items-center justify-center px-3 py-2 rounded-lg bg-green-600 text-white font-medium hover:bg-green-700">
                Join Team
              </a>
            {% endif %}
            {% if request.user.role == "ADMIN" %}
               <form action="{% url 'teams:team_delete_team' team.id %}" method="POST">
                  {% csrf_token %}
                  <button type="submit" class="inline-flex items-center justify-center px-3 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700">
                    Delete Team</button>
                </form>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if page_obj.paginator.num_pages > 1 %}
      <div class="mt-8 flex items-center justify-between">
        <div class="text-sm text-gray-600">
          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </div>
        <div class="flex gap-2">
          {% if page_obj.has_previous %}
            <a href="?q={{ q|urlencode }}&filter={{ filter }}&per_page={{ per_page }}&page={{ page_obj.previous_page_number }}"
               class="px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">Previous</a>
          {% else %}
            <span class="px-3 py-2 rounded-lg border border-gray-200 text-gray-400">Previous</span>
          {% endif %}

          {% if page_obj.has_next %}
            <a href="?q={{ q|urlencode }}&filter={{ filter }}&per_page={{ per_page }}&page={{ page_obj.next_page_number }}"
               class="px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">Next</a>
          {% else %}
            <span class="px-3 py-2 rounded-lg border border-gray-200 text-gray-400">Next</span>
          {% endif %}
        </div>
      </div>
    {% endif %}
  {% else %}
    <div class="bg-white border border-gray-200 rounded-xl p-8 text-center text-gray-600">
      <p class="mb-3">No teams found.</p>
      <p class="text-sm">Try a different search or create your own team.</p>
      <a href="{% url 'teams:team_create' %}"
         class="mt-4 inline-flex items-center px-4 py-2 rounded-lg bg-indigo-600 text-white font-medium shadow hover:bg-indigo-700">
        + Create Team
      </a>
    </div>
  {% endif %}

  <div class="mt-8">
    <a href="{% url 'dashboard:dashboard_view' %}"
       class="inline-flex items-center px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">
      ← Back to Dashboard
    </a>
  </div>
</div>
{% endblock %}
